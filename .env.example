# Video Server Environment Configuration

# ==============================================================================
# OpenTelemetry / OTLP Configuration
# ==============================================================================

# ==============================================================================
# Database Configuration
# ==============================================================================

# SQLite Database URL
# The path to the SQLite database file
# Supports connection options:
#   - mode=rwc : Read, Write, Create if not exists
#   - mode=ro  : Read-only
#   - mode=rw  : Read-Write (no create)
# 
# Examples:
#   - Local development: sqlite:media.db?mode=rwc
#   - Production: sqlite:/var/lib/media-server/media.db?mode=rwc
#   - Read-only: sqlite:media.db?mode=ro
#
# Default: sqlite:media.db?mode=rwc
DATABASE_URL=sqlite:media.db?mode=rwc


# Enable OTLP telemetry (traces + logs)
# Set to 'true' to enable sending traces and logs to an OTLP endpoint (e.g., Vector, Jaeger, SigNoz)
# Set to 'false' to use console-only logging
# Default: false
ENABLE_OTLP=false

# OTLP Endpoint URL
# The gRPC endpoint for receiving traces and logs
# Common endpoints:
#   - Vector: http://localhost:4317
#   - Jaeger: http://localhost:4317
#   - SigNoz: http://localhost:4317
#   - OpenTelemetry Collector: http://localhost:4317
# Default: http://localhost:4317
OTLP_ENDPOINT=http://localhost:4317

# Rust Log Level
# Controls the verbosity of log output
# Options: trace, debug, info, warn, error
# Default: info
RUST_LOG=info

# ==============================================================================
# OIDC Authentication (Casdoor)
# ==============================================================================

# Casdoor OIDC Issuer URL
# This is your Casdoor server URL
# Example: http://localhost:8000 or https://auth.example.com
OIDC_ISSUER_URL=http://localhost:8000

# OIDC Client ID
# This is the application ID from your Casdoor application configuration
OIDC_CLIENT_ID=your-client-id

# OIDC Client Secret
# This is the client secret from your Casdoor application configuration
OIDC_CLIENT_SECRET=your-client-secret

# OIDC Redirect URI
# This must match the redirect URI configured in your Casdoor application
# Default: http://localhost:3000/oidc/callback
OIDC_REDIRECT_URI=http://localhost:3000/oidc/callback

# ==============================================================================
# Emergency Login Configuration
# ==============================================================================

# Enable Emergency Login
# Set to 'true' to enable emergency login (ONLY for recovery when OIDC is down)
# Set to 'false' for production to disable emergency login entirely
# Default: false
# WARNING: When enabled, the emergency login route becomes accessible
ENABLE_EMERGENCY_LOGIN=false

# Emergency Superuser Username
# Username for emergency login access
# Only used when ENABLE_EMERGENCY_LOGIN=true
# Default: admin
SU_USER=admin

# Emergency Superuser Password
# Password for emergency login access
# Only used when ENABLE_EMERGENCY_LOGIN=true
# IMPORTANT: Use a strong, unique password
# Default: (empty - must be set for emergency login to work)
SU_PWD=

# ==============================================================================
# Emergency Login Usage
# ==============================================================================
#
# The emergency login feature is designed for disaster recovery scenarios
# when your OIDC provider (Casdoor) is unavailable.
#
# PRODUCTION (Default):
# - ENABLE_EMERGENCY_LOGIN=false
# - Emergency login route does not exist (returns 404)
# - No emergency login button shown
# - Maximum security for production deployment
#
# EMERGENCY RECOVERY:
# 1. SSH into your server
# 2. Edit .env and set ENABLE_EMERGENCY_LOGIN=true
# 3. Set SU_USER and SU_PWD to secure credentials
# 4. Restart the server
# 5. Navigate to http://your-domain/login
# 6. Click "Emergency Login" button
# 7. Enter the SU_USER and SU_PWD credentials
# 8. Access granted - you can now manage the system
# 9. After fixing OIDC, disable emergency login again
#
# SECURITY NOTES:
# - Emergency login requires valid credentials even when enabled
# - All login attempts (success and failure) are logged
# - Only enable this feature when absolutely necessary
# - Never commit .env file with real credentials to version control
#
# ==============================================================================
# Casdoor Configuration Guide
# ==============================================================================
#
# 1. Create a new application in Casdoor:
#    - Go to your Casdoor admin panel
#    - Navigate to Applications
#    - Click "Add" to create a new application
#
# 2. Configure the application:
#    - Name: Video Server (or any name you prefer)
#    - Organization: Your organization
#    - Redirect URLs: http://localhost:3000/oidc/callback
#    - Grant types: authorization_code
#    - Response types: code
#    - Token format: JWT
#
# 3. Get your credentials:
#    - Client ID: Found in the application details
#    - Client Secret: Generated in the application details
#
# 4. Update the OIDC_ISSUER_URL:
#    - If Casdoor is running locally: http://localhost:8000
#    - If deployed: https://your-casdoor-domain.com
#
# 5. Copy this file to .env and update the values:
#    cp .env.example .env
#    # Edit .env with your actual values
#
# ==============================================================================
# Usage
# ==============================================================================
#
# The server will automatically load these environment variables on startup.
# If OIDC configuration fails, emergency login will still be available.
#
# Test your configuration:
# 1. Start the server: cargo run
# 2. Navigate to: http://localhost:3000/login
# 3. Click "Login with Appkask"
# 4. You should be redirected to your Casdoor login page
#
# ==============================================================================
# Production Deployment
# ==============================================================================
#
# For production:
# 1. Use HTTPS for all URLs
# 2. Store secrets securely (use secret management service)
# 3. Update redirect URIs to production domain
# 4. Enable CORS for production domain only
# 5. Use secure session cookies (already configured in code)
#
# Example production values:
# OIDC_ISSUER_URL=https://auth.appkask.com
# OIDC_CLIENT_ID=video-server-prod
# OIDC_CLIENT_SECRET=<secure-secret-from-vault>
# OIDC_REDIRECT_URI=https://video.appkask.com/oidc/callback
# ENABLE_EMERGENCY_LOGIN=false
# SU_USER=<secure-admin-username>
# SU_PWD=<secure-strong-password>
#
#
# ==============================================================================
# OTLP Logger (Vector -> SIGNOZ)
# ==============================================================================
#
#  OTLP Issuer URL
# This is your Vector URL
# Example: http://localhost:4317 or https://vector.appkask.com
ENABLE_OTLP=true
OTEL_SERVICE_NAME=media-server
OTLP_ENDPOINT=http://localhost:4317
