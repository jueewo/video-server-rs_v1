{% extends "base-tailwind.html" %}
{% block title %}{{ image.title }} - Image Gallery{% endblock %}

{% block extra_head %}
<style>
    .image-viewer-container {
        position: relative;
        width: 100%;
        min-height: 600px;
        background: linear-gradient(45deg, #1a1a1a 25%, #2a2a2a 25%, #2a2a2a 50%, #1a1a1a 50%, #1a1a1a 75%, #2a2a2a 75%, #2a2a2a);
        background-size: 20px 20px;
        border-radius: 0.5rem;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: default;
    }

    .image-viewer-container img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        transition: transform 0.3s ease, cursor 0.2s;
        transform-origin: center center;
    }

    .image-viewer-container img.zoomable {
        cursor: zoom-in;
    }

    .image-viewer-container img.zoomed {
        cursor: move;
        cursor: grab;
    }

    .image-viewer-container img.zoomed:active {
        cursor: grabbing;
    }

    .zoom-controls {
        position: absolute;
        top: 1rem;
        right: 1rem;
        display: flex;
        gap: 0.5rem;
        z-index: 10;
    }

    .view-mode-toggle {
        position: absolute;
        top: 1rem;
        left: 1rem;
        z-index: 10;
    }

    .zoom-indicator {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        z-index: 10;
    }

    .related-image-card {
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .related-image-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .stat-card {
        transition: all 0.2s;
    }

    .stat-card:hover {
        transform: scale(1.05);
    }

    .tag-badge {
        transition: all 0.2s;
        cursor: pointer;
    }

    .tag-badge:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .color-swatch {
        width: 48px;
        height: 48px;
        border-radius: 8px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .exif-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 1rem;
    }

    .exif-item {
        padding: 1rem;
        background: rgba(0, 0, 0, 0.02);
        border-radius: 0.5rem;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .share-button {
        transition: all 0.2s;
    }

    .share-button:hover {
        transform: translateY(-1px);
    }

    .qr-code-container {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 2rem;
        background: white;
        border-radius: 0.5rem;
    }

    .map-container {
        width: 100%;
        height: 300px;
        border-radius: 0.5rem;
        overflow: hidden;
        background: #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .action-button {
        transition: all 0.2s;
    }

    .action-button:hover {
        transform: translateY(-2px);
    }

    .description-text {
        white-space: pre-wrap;
        word-wrap: break-word;
        line-height: 1.6;
    }

    .metadata-section {
        border-left: 3px solid var(--primary);
        padding-left: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6 max-w-7xl" x-data="imageDetail()">
    <!-- Breadcrumb Navigation -->
    <nav class="text-sm breadcrumbs mb-6">
        <ul>
            <li><a href="/" class="hover:text-primary">Home</a></li>
            <li><a href="/images" class="hover:text-primary">Gallery</a></li>
            {% if image.category %}
            <li><a :href="'/images?category={{ image.category }}'" class="hover:text-primary capitalize">{{ image.category }}</a></li>
            {% endif %}
            <li class="font-semibold">{{ image.title }}</li>
        </ul>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Content (Left - 2 columns) -->
        <div class="lg:col-span-2 space-y-6">

            <!-- Image Viewer -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body p-0">
                    <div class="image-viewer-container" x-ref="imageContainer">
                        <!-- View Mode Toggle -->
                        <div class="view-mode-toggle">
                            <div class="dropdown dropdown-end">
                                <label tabindex="0" class="btn btn-sm btn-circle bg-black/50 hover:bg-black/70 border-none text-white">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" />
                                    </svg>
                                </label>
                                <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52 mt-2">
                                    <li><a @click="viewMode = 'fit'" :class="{ 'active': viewMode === 'fit' }">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h4a1 1 0 010 2H6.414l2.293 2.293a1 1 0 11-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4zm9 1a1 1 0 110-2h4a1 1 0 011 1v4a1 1 0 11-2 0V6.414l-2.293 2.293a1 1 0 11-1.414-1.414L13.586 5H12zm-9 7a1 1 0 112 0v1.586l2.293-2.293a1 1 0 011.414 1.414L6.414 15H8a1 1 0 110 2H4a1 1 0 01-1-1v-4zm13-1a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 110-2h1.586l-2.293-2.293a1 1 0 011.414-1.414L15 13.586V12a1 1 0 011-1z" clip-rule="evenodd" />
                                        </svg>
                                        Fit to Screen
                                    </a></li>
                                    <li><a @click="viewMode = 'fill'" :class="{ 'active': viewMode === 'fill' }">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M3 12v3c0 1.657 3.134 3 7 3s7-1.343 7-3v-3c0 1.657-3.134 3-7 3s-7-1.343-7-3z" />
                                            <path d="M3 7v3c0 1.657 3.134 3 7 3s7-1.343 7-3V7c0 1.657-3.134 3-7 3S3 8.657 3 7z" />
                                            <path d="M17 5c0 1.657-3.134 3-7 3S3 6.657 3 5s3.134-3 7-3 7 1.343 7 3z" />
                                        </svg>
                                        Fill Container
                                    </a></li>
                                    <li><a @click="viewMode = 'actual'" :class="{ 'active': viewMode === 'actual' }">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                                        </svg>
                                        Actual Size
                                    </a></li>
                                </ul>
                            </div>
                        </div>

                        <!-- Zoom Controls -->
                        <div class="zoom-controls">
                            <button @click="zoomIn" class="btn btn-sm btn-circle bg-black/50 hover:bg-black/70 border-none text-white" title="Zoom In (Ctrl + +)">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <button @click="zoomOut" class="btn btn-sm btn-circle bg-black/50 hover:bg-black/70 border-none text-white" title="Zoom Out (Ctrl + -)">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <button @click="resetZoom" class="btn btn-sm btn-circle bg-black/50 hover:bg-black/70 border-none text-white" title="Reset Zoom (Ctrl + 0)">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>

                        <!-- Zoom Indicator -->
                        <div class="zoom-indicator" x-show="zoomLevel !== 1" x-transition>
                            <span x-text="Math.round(zoomLevel * 100) + '%'"></span>
                        </div>

                        <!-- Main Image -->
                        <img
                            id="mainImage"
                            :src="'/images/{{ image.slug }}' + (showFullRes ? '?full=true' : '')"
                            alt="{{ image.alt_text | default(value=image.title) }}"
                            @click="handleImageClick"
                            @mousedown="startPan"
                            @mousemove="pan"
                            @mouseup="endPan"
                            @mouseleave="endPan"
                            @wheel="handleWheel"
                            :class="{
                                'zoomable': zoomLevel === 1,
                                'zoomed': zoomLevel > 1
                            }"
                            :style="imageStyle"
                            draggable="false"
                        />
                    </div>

                    <!-- Image Controls Bar -->
                    <div class="flex justify-between items-center p-4 bg-base-200 flex-wrap gap-4">
                        <div class="flex gap-2 items-center flex-wrap">
                            <div class="badge badge-outline gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                                </svg>
                                {{ image.width | default(value="?") }}√ó{{ image.height | default(value="?") }}
                            </div>
                            <div class="badge badge-outline gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                <span x-text="formatFileSize({{ image.file_size | default(value=0) }})"></span>
                            </div>
                            <div class="badge badge-outline uppercase">{{ image.format | default(value="jpg") }}</div>
                            <label class="label cursor-pointer gap-2">
                                <input type="checkbox" class="toggle toggle-sm toggle-primary" x-model="showFullRes" />
                                <span class="label-text text-xs">Full Resolution</span>
                            </label>
                        </div>
                        <div class="flex gap-2">
                            <a href="/images/{{ image.slug }}?download=true" class="btn btn-sm btn-primary gap-2 action-button" @click="trackDownload">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                Download
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Image Info Card -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <!-- Title and Actions -->
                    <div class="flex flex-col gap-4 mb-4">
                        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                            <div class="flex-1">
                                <h1 class="text-3xl font-bold text-base-content mb-3">{{ image.title }}</h1>
                                <div class="flex flex-wrap items-center gap-3 text-sm text-base-content/60">
                                    <span class="flex items-center gap-1.5">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                        </svg>
                                        <span x-text="viewCount + ' views'">{{ image.view_count }} views</span>
                                    </span>
                                    <span>‚Ä¢</span>
                                    <span class="flex items-center gap-1.5">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                        </svg>
                                        {{ image.upload_date | default(value="Unknown date") }}
                                    </span>
                                    {% if image.taken_at %}
                                    <span>‚Ä¢</span>
                                    <span class="flex items-center gap-1.5">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                                        </svg>
                                        Taken: {{ image.taken_at }}
                                    </span>
                                    {% endif %}
                                </div>
                                <div class="flex flex-wrap items-center gap-2 mt-3">
                                    <span class="badge" :class="'{{ image.is_public }}' == 'true' ? 'badge-success' : 'badge-error'">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M10 2a5 5 0 00-5 5v2a2 2 0 00-2 2v5a2 2 0 002 2h10a2 2 0 002-2v-5a2 2 0 00-2-2H7V7a3 3 0 015.905-.75 1 1 0 001.937-.5A5.002 5.002 0 0010 2z" />
                                        </svg>
                                        {{ image.is_public ? 'PUBLIC' : 'PRIVATE' }}
                                    </span>
                                    {% if image.featured %}
                                    <span class="badge badge-secondary gap-1">
                                        ‚≠ê FEATURED
                                    </span>
                                    {% endif %}
                                    {% if image.status %}
                                    <span class="badge badge-outline capitalize">{{ image.status }}</span>
                                    {% endif %}
                                    {% if image.category %}
                                    <span class="badge badge-primary badge-outline capitalize">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z" />
                                        </svg>
                                        {{ image.category }}
                                    </span>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex flex-wrap gap-2">
                                <button @click="toggleLike" class="btn btn-outline gap-2 action-button" :class="{ 'btn-primary': liked }">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" :fill="liked ? 'currentColor' : 'none'" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                    </svg>
                                    <span x-text="likeCount">{{ image.like_count }}</span>
                                </button>

                                <button @click="showShareModal = true" class="btn btn-outline gap-2 action-button">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                                    </svg>
                                    Share
                                </button>

                                {% if authenticated %}
                                <a href="/images/{{ image.slug }}/edit" class="btn btn-outline gap-2 action-button">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                    Edit
                                </a>

                                <button @click="showDeleteModal = true" class="btn btn-error btn-outline gap-2 action-button">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                    Delete
                                </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <!-- Tags Section -->
                    <div x-show="tags.length > 0" class="mb-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-bold text-lg flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                </svg>
                                Tags
                            </h3>
                            {% if authenticated %}
                            <button @click="showTagModal = true" class="btn btn-xs btn-ghost gap-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                                </svg>
                                Add Tags
                            </button>
                            {% endif %}
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <template x-for="tag in tags" :key="tag">
                                <a
                                    :href="'/images?tag=' + encodeURIComponent(tag)"
                                    class="badge badge-primary badge-lg gap-2 tag-badge"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                    </svg>
                                    <span x-text="tag"></span>
                                </a>
                            </template>
                        </div>
                    </div>

                    <!-- Description -->
                    {% if image.description %}
                    <div class="mb-4 metadata-section">
                        <h3 class="font-bold text-lg mb-2 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" />
                            </svg>
                            Description
                        </h3>
                        <p class="text-base-content/80 description-text">{{ image.description }}</p>
                    </div>
                    {% endif %}

                    <!-- Image Details Collapse -->
                    <div class="collapse collapse-arrow bg-base-200 rounded-lg">
                        <input type="checkbox" checked />
                        <div class="collapse-title font-bold text-lg flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                            </svg>
                            üìä Image Details
                        </div>
                        <div class="collapse-content">
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-2">
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Dimensions</div>
                                    <div class="font-semibold">{{ image.width | default(value="?") }} √ó {{ image.height | default(value="?") }} px</div>
                                </div>
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Aspect Ratio</div>
                                    <div class="font-semibold">{% if image.width and image.height %}{{ (image.width / image.height) | round(precision=2) }}:1{% else %}N/A{% endif %}</div>
                                </div>
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">File Size</div>
                                    <div class="font-semibold" x-text="formatFileSize({{ image.file_size | default(value=0) }})"></div>
                                </div>
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Format</div>
                                    <div class="font-semibold uppercase">{{ image.format | default(value="JPEG") }}</div>
                                </div>
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Megapixels</div>
                                    <div class="font-semibold">
                                        {% if image.width and image.height %}
                                        {{ ((image.width * image.height) / 1000000) | round(precision=1) }} MP
                                        {% else %}
                                        N/A
                                        {% endif %}
                                    </div>
                                </div>
                                {% if image.collection %}
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Collection</div>
                                    <div class="font-semibold">{{ image.collection }}</div>
                                </div>
                                {% endif %}
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Status</div>
                                    <div class="font-semibold capitalize">{{ image.status | default(value="active") }}</div>
                                </div>
                                <div class="exif-item col-span-full">
                                    <div class="text-xs text-base-content/60 mb-1">Image ID</div>
                                    <div class="font-mono text-sm">{{ image.slug }}</div>
                                </div>
                                {% if image.dominant_color %}
                                <div class="exif-item col-span-full">
                                    <div class="text-xs text-base-content/60 mb-2">Dominant Color</div>
                                    <div class="flex items-center gap-4">
                                        <div class="color-swatch" style="background-color: {{ image.dominant_color }}"></div>
                                        <span class="font-mono text-sm">{{ image.dominant_color }}</span>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- EXIF Data Collapse -->
                    {% if image.camera_make or image.camera_model or image.taken_at or image.lens_model or image.focal_length or image.aperture or image.shutter_speed or image.iso %}
                    <div class="collapse collapse-arrow bg-base-200 rounded-lg mt-2">
                        <input type="checkbox" />
                        <div class="collapse-title font-bold text-lg flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                            </svg>
                            üì∑ Camera & EXIF Data
                        </div>
                        <div class="collapse-content">
                            <div class="exif-grid mt-2">
                                {% if image.camera_make %}
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Camera Make</div>
                                    <div class="font-semibold">{{ image.camera_make }}</div>
                                </div>
                                {% endif %}
                                {% if image.camera_model %}
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Camera Model</div>
                                    <div class="font-semibold">{{ image.camera_model }}</div>
                                </div>
                                {% endif %}
                                {% if image.lens_model %}
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Lens</div>
                                    <div class="font-semibold">{{ image.lens_model }}</div>
                                </div>
                                {% endif %}
                                {% if image.focal_length %}
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Focal Length</div>
                                    <div class="font-semibold">{{ image.focal_length }}mm</div>
                                </div>
                                {% endif %}
                                {% if image.aperture %}
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Aperture</div>
                                    <div class="font-semibold">f/{{ image.aperture }}</div>
                                </div>
                                {% endif %}
                                {% if image.shutter_speed %}
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Shutter Speed</div>
                                    <div class="font-semibold">{{ image.shutter_speed }}s</div>
                                </div>
                                {% endif %}
                                {% if image.iso %}
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">ISO</div>
                                    <div class="font-semibold">{{ image.iso }}</div>
                                </div>
                                {% endif %}
                                {% if image.exposure_bias %}
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Exposure Bias</div>
                                    <div class="font-semibold">{{ image.exposure_bias }} EV</div>
                                </div>
                                {% endif %}
                                {% if image.flash %}
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">Flash</div>
                                    <div class="font-semibold capitalize">{{ image.flash }}</div>
                                </div>
                                {% endif %}
                                {% if image.white_balance %}
                                <div class="exif-item">
                                    <div class="text-xs text-base-content/60 mb-1">White Balance</div>
                                    <div class="font-semibold capitalize">{{ image.white_balance }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- GPS Location -->
                    {% if image.gps_latitude and image.gps_longitude %}
                    <div class="collapse collapse-arrow bg-base-200 rounded-lg mt-2">
                        <input type="checkbox" />
                        <div class="collapse-title font-bold text-lg flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                            </svg>
                            üìç Location
                        </div>
                        <div class="collapse-content">
                            <div class="mt-2 space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="exif-item">
                                        <div class="text-xs text-base-content/60 mb-1">Latitude</div>
                                        <div class="font-mono text-sm">{{ image.gps_latitude }}</div>
                                    </div>
                                    <div class="exif-item">
                                        <div class="text-xs text-base-content/60 mb-1">Longitude</div>
                                        <div class="font-mono text-sm">{{ image.gps_longitude }}</div>
                                    </div>
                                </div>
                                <div class="map-container">
                                    <a
                                        href="https://www.google.com/maps?q={{ image.gps_latitude }},{{ image.gps_longitude }}"
                                        target="_blank"
                                        class="btn btn-primary gap-2"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                                        </svg>
                                        View on Google Maps
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                </div>
            </div>

            <!-- Related Images -->
            <div class="card bg-base-100 shadow-xl" x-show="relatedImages.length > 0">
                <div class="card-body">
                    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                        </svg>
                        Related Images
                    </h3>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                        <template x-for="relatedImg in relatedImages" :key="relatedImg.id">
                            <a :href="'/images/' + relatedImg.slug" class="related-image-card">
                                <div class="card bg-base-200 shadow-md">
                                    <figure class="aspect-square">
                                        <img
                                            :src="relatedImg.thumbnail_url || '/images/' + relatedImg.slug + '/thumb'"
                                            :alt="relatedImg.title"
                                            class="object-cover w-full h-full"
                                            loading="lazy"
                                        />
                                    </figure>
                                    <div class="card-body p-3">
                                        <h4 class="text-sm font-semibold line-clamp-2" x-text="relatedImg.title"></h4>
                                        <div class="flex items-center gap-2 text-xs text-base-content/60 mt-1">
                                            <span class="flex items-center gap-1">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                                </svg>
                                                <span x-text="relatedImg.view_count || 0"></span>
                                            </span>
                                            <span class="flex items-center gap-1">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                                                </svg>
                                                <span x-text="relatedImg.like_count || 0"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </template>
                    </div>
                </div>
            </div>

        </div>

        <!-- Sidebar (Right - 1 column) -->
        <div class="lg:col-span-1 space-y-6">

            <!-- Statistics Card -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z" />
                        </svg>
                        Statistics
                    </h3>
                    <div class="space-y-3">
                        <div class="stat-card bg-base-200 p-4 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-xs text-base-content/60">Views</div>
                                    <div class="text-2xl font-bold" x-text="viewCount">{{ image.view_count }}</div>
                                </div>
                                <div class="text-primary">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card bg-base-200 p-4 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-xs text-base-content/60">Likes</div>
                                    <div class="text-2xl font-bold" x-text="likeCount">{{ image.like_count }}</div>
                                </div>
                                <div class="text-error">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card bg-base-200 p-4 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-xs text-base-content/60">Downloads</div>
                                    <div class="text-2xl font-bold" x-text="downloadCount">{{ image.download_count | default(value=0) }}</div>
                                </div>
                                <div class="text-success">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z" />
                        </svg>
                        Quick Actions
                    </h3>
                    <div class="space-y-2">
                        <button @click="copyImageUrl" class="btn btn-outline btn-block gap-2 share-button">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M8 2a1 1 0 000 2h2a1 1 0 100-2H8z" />
                                <path d="M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5z" />
                            </svg>
                            Copy Image URL
                        </button>

                        <button @click="copyEmbedCode" class="btn btn-outline btn-block gap-2 share-button">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            Copy Embed Code
                        </button>

                        <button @click="showQRCode = !showQRCode" class="btn btn-outline btn-block gap-2 share-button">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm2 2V5h1v1H5zM3 13a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1H4a1 1 0 01-1-1v-3zm2 2v-1h1v1H5zM13 3a1 1 0 00-1 1v3a1 1 0 001 1h3a1 1 0 001-1V4a1 1 0 00-1-1h-3zm1 2v1h1V5h-1z" clip-rule="evenodd" />
                                <path d="M11 4a1 1 0 10-2 0v1a1 1 0 002 0V4zM10 7a1 1 0 011 1v1h2a1 1 0 110 2h-3a1 1 0 01-1-1V8a1 1 0 011-1zM16 9a1 1 0 100 2 1 1 0 000-2zM9 13a1 1 0 011-1h1a1 1 0 110 2v2a1 1 0 11-2 0v-3zM7 11a1 1 0 100-2H4a1 1 0 100 2h3zM17 13a1 1 0 01-1 1h-2a1 1 0 110-2h2a1 1 0 011 1zM16 17a1 1 0 100-2h-3a1 1 0 100 2h3z" />
                            </svg>
                            Show QR Code
                        </button>

                        <a href="/images/{{ image.slug }}?download=true" @click="trackDownload" class="btn btn-primary btn-block gap-2 share-button">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            Download Image
                        </a>
                    </div>

                    <!-- QR Code Display -->
                    <div x-show="showQRCode" x-transition class="mt-4">
                        <div class="qr-code-container">
                            <div id="qrcode" class="flex flex-col items-center gap-2">
                                <div class="bg-gray-200 w-48 h-48 flex items-center justify-center rounded">
                                    <span class="text-sm text-gray-500">QR Code</span>
                                </div>
                                <p class="text-xs text-center text-base-content/60">Scan to view image</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Collection Info -->
            {% if image.collection %}
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h3 class="font-bold text-lg mb-2 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z" />
                        </svg>
                        Collection
                    </h3>
                    <p class="text-base-content/80">{{ image.collection }}</p>
                    <a href="/images?collection={{ image.collection }}" class="btn btn-sm btn-outline mt-2 gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                        </svg>
                        View Collection
                    </a>
                </div>
            </div>
            {% endif %}

        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal" :class="{ 'modal-open': showShareModal }">
        <div class="modal-box max-w-2xl">
            <h3 class="font-bold text-2xl mb-4 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" />
                </svg>
                Share Image
            </h3>

            <!-- Share URL -->
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text font-semibold">Image URL</span>
                </label>
                <div class="flex gap-2">
                    <input
                        type="text"
                        :value="window.location.href"
                        class="input input-bordered flex-1 font-mono text-sm"
                        readonly
                        x-ref="shareUrl"
                    />
                    <button @click="copyToClipboard($refs.shareUrl.value, 'URL copied!')" class="btn btn-square btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M8 2a1 1 0 000 2h2a1 1 0 100-2H8z" />
                            <path d="M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5z" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Embed Code -->
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text font-semibold">Embed Code (HTML)</span>
                </label>
                <textarea
                    class="textarea textarea-bordered font-mono text-xs h-24"
                    readonly
                    x-ref="embedCode"
                ><img src="{{ window.location.origin }}/images/{{ image.slug }}" alt="{{ image.title }}" /></textarea>
                <button @click="copyToClipboard($refs.embedCode.value, 'Embed code copied!')" class="btn btn-sm btn-outline mt-2 gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M8 2a1 1 0 000 2h2a1 1 0 100-2H8z" />
                        <path d="M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5z" />
                    </svg>
                    Copy Embed Code
                </button>
            </div>

            <!-- Social Share Buttons -->
            <div class="form-control mb-6">
                <label class="label">
                    <span class="label-text font-semibold">Share on Social Media</span>
                </label>
                <div class="grid grid-cols-2 sm:grid-cols-5 gap-2">
                    <a :href="'https://twitter.com/intent/tweet?url=' + encodeURIComponent(window.location.href) + '&text=' + encodeURIComponent('{{ image.title }}')" target="_blank" class="btn btn-outline gap-2">
                        <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/></svg>
                        Twitter
                    </a>
                    <a :href="'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(window.location.href)" target="_blank" class="btn btn-outline gap-2">
                        <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>
                        Facebook
                    </a>
                    <a :href="'https://www.pinterest.com/pin/create/button/?url=' + encodeURIComponent(window.location.href) + '&media=' + encodeURIComponent(window.location.origin + '/images/{{ image.slug }}') + '&description=' + encodeURIComponent('{{ image.title }}')" target="_blank" class="btn btn-outline gap-2">
                        <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0a12 12 0 00-4.285 23.22c-.059-.537-.114-1.363.024-1.948l.987-4.185s-.251-.503-.251-1.246c0-1.168.677-2.04 1.52-2.04.718 0 1.064.539 1.064 1.185 0 .722-.46 1.801-.697 2.802-.198.837.42 1.52 1.246 1.52 1.496 0 2.646-1.576 2.646-3.851 0-2.013-1.447-3.419-3.514-3.419-2.394 0-3.8 1.795-3.8 3.651 0 .723.279 1.498.627 1.918a.203.203 0 01.047.194c-.052.216-.168.683-.191.778-.03.126-.1.153-.231.092-1.246-.58-2.026-2.401-2.026-3.865 0-2.649 1.924-5.081 5.547-5.081 2.912 0 5.176 2.075 5.176 4.847 0 2.893-1.824 5.223-4.356 5.223-.851 0-1.65-.443-1.924-.965l-.524 1.997c-.19.732-.703 1.648-1.047 2.206A12 12 0 1012 0z"/></svg>
                        Pinterest
                    </a>
                    <a :href="'https://www.reddit.com/submit?url=' + encodeURIComponent(window.location.href) + '&title=' + encodeURIComponent('{{ image.title }}')" target="_blank" class="btn btn-outline gap-2">
                        <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 01.042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 014.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 01.14-.197.35.35 0 01.238-.042l2.906.617a1.214 1.214 0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 00-.231.094.33.33 0 000 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 00.029-.463.33.33 0 00-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 00-.232-.095z"/></svg>
                        Reddit
                    </a>
                    <button @click="shareViaEmail" class="btn btn-outline gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                        </svg>
                        Email
                    </button>
                </div>
            </div>

            <div class="alert alert-info text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                </svg>
                <span>Share this beautiful image with your friends and community!</span>
            </div>

            <div class="modal-action">
                <button @click="showShareModal = false" class="btn">Close</button>
            </div>
        </div>
        <div class="modal-backdrop" @click="showShareModal = false"></div>
    </div>

    <!-- Delete Confirmation Modal -->
    {% if authenticated %}
    <div class="modal" :class="{ 'modal-open': showDeleteModal }">
        <div class="modal-box">
            <h3 class="font-bold text-xl mb-4 text-error flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
                Confirm Deletion
            </h3>
            <p class="py-4">Are you sure you want to delete "<strong>{{ image.title }}</strong>"? This action cannot be undone.</p>

            <div class="alert alert-warning mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
                <span>This will permanently delete the image and all associated data!</span>
            </div>

            <div class="modal-action">
                <button @click="showDeleteModal = false" class="btn">Cancel</button>
                <button @click="deleteImage" class="btn btn-error gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                    Delete Permanently
                </button>
            </div>
        </div>
        <div class="modal-backdrop" @click="showDeleteModal = false"></div>
    </div>

    <!-- Tag Management Modal -->
    <div class="modal" :class="{ 'modal-open': showTagModal }">
        <div class="modal-box">
            <h3 class="font-bold text-xl mb-4 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                </svg>
                Manage Tags
            </h3>

            <!-- Current Tags -->
            <div class="mb-4">
                <label class="label">
                    <span class="label-text font-semibold">Current Tags</span>
                </label>
                <div class="flex flex-wrap gap-2">
                    <template x-for="tag in tags" :key="tag">
                        <span class="badge badge-primary gap-2">
                            <span x-text="tag"></span>
                            <button @click="removeTag(tag)" class="btn btn-ghost btn-xs btn-circle">√ó</button>
                        </span>
                    </template>
                </div>
            </div>

            <!-- Add New Tags -->
            <div class="form-control">
                <label class="label">
                    <span class="label-text font-semibold">Add New Tags</span>
                </label>
                <div class="flex gap-2">
                    <input
                        type="text"
                        placeholder="Enter tag name..."
                        class="input input-bordered flex-1"
                        x-model="newTagInput"
                        @keyup.enter="addTag"
                    />
                    <button @click="addTag" class="btn btn-primary">Add</button>
                </div>
                <label class="label">
                    <span class="label-text-alt">Press Enter to add multiple tags quickly</span>
                </label>
            </div>

            <div class="modal-action">
                <button @click="showTagModal = false" class="btn">Close</button>
            </div>
        </div>
        <div class="modal-backdrop" @click="showTagModal = false"></div>
    </div>
    {% endif %}

</div>

<script>
function imageDetail() {
    return {
        // State
        viewCount: {{ image.view_count }},
        likeCount: {{ image.like_count }},
        downloadCount: {{ image.download_count | default(value=0) }},
        liked: false,
        tags: {{ image.tags | json | safe }},
        relatedImages: [],

        // Modals
        showShareModal: false,
        showDeleteModal: false,
        showQRCode: false,
        showTagModal: false,

        // Image viewer
        viewMode: 'fit', // fit, fill, actual
        isZoomed: false,
        zoomLevel: 1,
        panX: 0,
        panY: 0,
        isPanning: false,
        startX: 0,
        startY: 0,
        showFullRes: false,

        // Tag management
        newTagInput: '',

        // Computed property for image style
        get imageStyle() {
            if (this.viewMode === 'actual' || this.zoomLevel > 1) {
                return {
                    transform: `scale(${this.zoomLevel}) translate(${this.panX}px, ${this.panY}px)`,
                    maxWidth: 'none',
                    maxHeight: 'none'
                };
            }
            return {};
        },

        // Initialize
        init() {
            this.checkLikeStatus();
            this.loadRelatedImages();
            this.incrementViewCount();
            this.setupKeyboardShortcuts();
        },

        // View controls
        zoomIn() {
            this.zoomLevel = Math.min(this.zoomLevel + 0.25, 5);
            this.isZoomed = this.zoomLevel > 1;
        },

        zoomOut() {
            this.zoomLevel = Math.max(this.zoomLevel - 0.25, 0.5);
            this.isZoomed = this.zoomLevel > 1;
            if (this.zoomLevel === 1) {
                this.panX = 0;
                this.panY = 0;
            }
        },

        resetZoom() {
            this.zoomLevel = 1;
            this.panX = 0;
            this.panY = 0;
            this.isZoomed = false;
            this.viewMode = 'fit';
        },

        handleImageClick(e) {
            if (this.zoomLevel === 1) {
                this.zoomIn();
            }
        },

        startPan(e) {
            if (this.zoomLevel > 1) {
                this.isPanning = true;
                this.startX = e.clientX - this.panX;
                this.startY = e.clientY - this.panY;
            }
        },

        pan(e) {
            if (this.isPanning && this.zoomLevel > 1) {
                this.panX = e.clientX - this.startX;
                this.panY = e.clientY - this.startY;
            }
        },

        endPan() {
            this.isPanning = false;
        },

        handleWheel(e) {
            e.preventDefault();
            if (e.deltaY < 0) {
                this.zoomIn();
            } else {
                this.zoomOut();
            }
        },

        setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === '=' || e.key === '+') {
                        e.preventDefault();
                        this.zoomIn();
                    } else if (e.key === '-') {
                        e.preventDefault();
                        this.zoomOut();
                    } else if (e.key === '0') {
                        e.preventDefault();
                        this.resetZoom();
                    }
                }
                if (e.key === 'Escape') {
                    this.showShareModal = false;
                    this.showDeleteModal = false;
                    this.showTagModal = false;
                }
            });
        },

        // Analytics
        async incrementViewCount() {
            try {
                const response = await fetch('/api/images/{{ image.slug }}/view', {
                    method: 'POST'
                });
                if (response.ok) {
                    const data = await response.json();
                    this.viewCount = data.view_count;
                }
            } catch (error) {
                console.error('Failed to increment view count:', error);
            }
        },

        async checkLikeStatus() {
            try {
                const response = await fetch('/api/images/{{ image.slug }}/like-status');
                if (response.ok) {
                    const data = await response.json();
                    this.liked = data.liked;
                }
            } catch (error) {
                console.error('Failed to check like status:', error);
            }
        },

        async toggleLike() {
            try {
                const response = await fetch('/api/images/{{ image.slug }}/like', {
                    method: 'POST'
                });
                if (response.ok) {
                    const data = await response.json();
                    this.liked = data.liked;
                    this.likeCount = data.like_count;
                }
            } catch (error) {
                console.error('Failed to toggle like:', error);
            }
        },

        async trackDownload() {
            try {
                await fetch('/api/images/{{ image.slug }}/download', {
                    method: 'POST'
                });
                this.downloadCount++;
            } catch (error) {
                console.error('Failed to track download:', error);
            }
        },

        // Related images
        async loadRelatedImages() {
            try {
                const response = await fetch('/api/images/{{ image.slug }}/related');
                if (response.ok) {
                    const data = await response.json();
                    this.relatedImages = data.images || [];
                }
            } catch (error) {
                console.error('Failed to load related images:', error);
            }
        },

        // Sharing
        async copyImageUrl() {
            await this.copyToClipboard(window.location.href, 'Image URL copied!');
        },

        async copyEmbedCode() {
            const embedCode = `<img src="${window.location.origin}/images/{{ image.slug }}" alt="{{ image.title }}" />`;
            await this.copyToClipboard(embedCode, 'Embed code copied!');
        },

        async copyToClipboard(text, message) {
            try {
                await navigator.clipboard.writeText(text);
                this.showNotification(message, 'success');
            } catch (error) {
                console.error('Failed to copy to clipboard:', error);
                this.showNotification('Failed to copy', 'error');
            }
        },

        shareViaEmail() {
            const subject = encodeURIComponent('{{ image.title }}');
            const body = encodeURIComponent(`Check out this image: ${window.location.href}`);
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        },

        // Tag management
        async addTag() {
            if (!this.newTagInput.trim()) return;

            const newTag = this.newTagInput.trim();
            if (this.tags.includes(newTag)) {
                this.showNotification('Tag already exists', 'warning');
                return;
            }

            try {
                const response = await fetch('/api/images/{{ image.slug }}/tags', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tag: newTag })
                });

                if (response.ok) {
                    this.tags.push(newTag);
                    this.newTagInput = '';
                    this.showNotification('Tag added!', 'success');
                }
            } catch (error) {
                console.error('Failed to add tag:', error);
                this.showNotification('Failed to add tag', 'error');
            }
        },

        async removeTag(tag) {
            try {
                const response = await fetch(`/api/images/{{ image.slug }}/tags/${encodeURIComponent(tag)}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    this.tags = this.tags.filter(t => t !== tag);
                    this.showNotification('Tag removed!', 'success');
                }
            } catch (error) {
                console.error('Failed to remove tag:', error);
                this.showNotification('Failed to remove tag', 'error');
            }
        },

        // Delete image
        async deleteImage() {
            try {
                const response = await fetch('/images/{{ image.slug }}', {
                    method: 'DELETE'
                });

                if (response.ok) {
                    this.showNotification('Image deleted!', 'success');
                    setTimeout(() => {
                        window.location.href = '/images';
                    }, 1500);
                }
            } catch (error) {
                console.error('Failed to delete image:', error);
                this.showNotification('Failed to delete image', 'error');
            }
        },

        // Utilities
        formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
        },

        showNotification(message, type = 'info') {
            // You can integrate with your notification system here
            console.log(`[${type}] ${message}`);
            alert(message); // Temporary - replace with toast notification
        }
    };
}
</script>
{% endblock %}
