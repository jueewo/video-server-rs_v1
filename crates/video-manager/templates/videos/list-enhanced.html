{% extends "base-tailwind.html" %}
{% block title %}Video Library - Video Server{% endblock %}

{% block extra_head %}
<style>
    .video-card-hover {
        transition: all 0.3s ease;
    }
    .video-card-hover:hover {
        transform: translateY(-4px);
    }
    .filter-sidebar {
        max-height: calc(100vh - 200px);
        overflow-y: auto;
    }
    .search-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        z-index: 20;
        max-height: 300px;
        overflow-y: auto;
    }
    .view-mode-icon {
        transition: all 0.2s;
    }
    .view-mode-active {
        background: hsl(var(--p));
        color: hsl(var(--pc));
    }
    .bulk-action-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 40;
        transform: translateY(100%);
        transition: transform 0.3s ease;
    }
    .bulk-action-bar.show {
        transform: translateY(0);
    }
    .tag-filter-item:hover {
        background: hsl(var(--p) / 0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-7xl" x-data="videoLibrary()">
    <!-- Header -->
    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6 gap-4">
        <div>
            <h1 class="text-4xl font-bold text-base-content mb-2">üé• Video Library</h1>
            <p class="text-lg text-base-content/70">
                <span x-text="filteredVideos.length"></span> videos available
            </p>
        </div>

        <div class="flex flex-wrap items-center gap-3">
            {% if authenticated %}
            <a href="/videos/upload" class="btn btn-primary gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                </svg>
                Upload Video
            </a>
            <div class="badge badge-success gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
                Authenticated
            </div>
            {% else %}
            <div class="badge badge-info gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                </svg>
                Guest Mode
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Search Bar -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body p-4">
            <div class="flex flex-col lg:flex-row gap-4">
                <!-- Search Input -->
                <div class="relative flex-1">
                    <div class="relative">
                        <input
                            type="text"
                            x-model="searchQuery"
                            @input="handleSearch"
                            placeholder="Search videos by title, description, or tags..."
                            class="input input-bordered w-full pr-10"
                        >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute right-3 top-1/2 -translate-y-1/2 text-base-content/40" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                    </div>

                    <!-- Search Suggestions -->
                    <div
                        x-show="searchSuggestions.length > 0 && searchQuery.length > 0"
                        class="search-suggestions menu bg-base-200 rounded-box shadow-lg mt-2"
                        x-cloak
                    >
                        <template x-for="suggestion in searchSuggestions" :key="suggestion">
                            <li></li><a @click="applySearchSuggestion(suggestion)" x-text="suggestion"></a></li>
                        </template>
                    </div>
                </div>

                <!-- View Mode Toggles -->
                <div class="btn-group">
                    <button
                        @click="viewMode = 'grid'"
                        class="btn btn-sm"
                        :class="{ 'view-mode-active': viewMode === 'grid' }"
                        title="Grid View"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                        </svg>
                    </button>
                    <button
                        @click="viewMode = 'list'"
                        class="btn btn-sm"
                        :class="{ 'view-mode-active': viewMode === 'list' }"
                        title="List View"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    <button
                        @click="viewMode = 'table'"
                        class="btn btn-sm"
                        :class="{ 'view-mode-active': viewMode === 'table' }"
                        title="Table View"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5 4a3 3 0 00-3 3v6a3 3 0 003 3h10a3 3 0 003-3V7a3 3 0 00-3-3H5zm-1 9v-1h5v2H5a1 1 0 01-1-1zm7 1h4a1 1 0 001-1v-1h-5v2zm0-4h5V8h-5v2zM9 8H4v2h5V8z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!-- Filter Toggle (Mobile) -->
                <button @click="showFilters = !showFilters" class="btn btn-outline btn-sm lg:hidden gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd" />
                    </svg>
                    Filters
                    <span x-show="activeFiltersCount > 0" class="badge badge-primary badge-sm" x-text="activeFiltersCount"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content: Filters + Videos -->
    <div class="flex flex-col lg:flex-row gap-6">
        <!-- Filter Sidebar -->
        <div
            class="lg:w-80 space-y-6"
            :class="{ 'hidden lg:block': !showFilters }"
        >
            <!-- Active Filters -->
            <div x-show="activeFiltersCount > 0" class="card bg-base-100 shadow-xl">
                <div class="card-body p-4">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold text-lg">Active Filters</h3>
                        <button @click="clearAllFilters" class="btn btn-ghost btn-xs gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            Clear All
                        </button>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <template x-for="tag in filters.tags" :key="tag">
                            <div class="badge badge-primary gap-1">
                                <span x-text="tag"></span>
                                <button @click="removeTagFilter(tag)" class="btn btn-ghost btn-xs btn-circle">‚úï</button>
                            </div>
                        </template>
                        <div x-show="filters.category" class="badge badge-secondary gap-1">
                            <span x-text="filters.category"></span>
                            <button @click="filters.category = null" class="btn btn-ghost btn-xs btn-circle">‚úï</button>
                        </div>
                        <div x-show="filters.status" class="badge badge-accent gap-1">
                            <span x-text="filters.status"></span>
                            <button @click="filters.status = null" class="btn btn-ghost btn-xs btn-circle">‚úï</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sort Options -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body p-4">
                    <h3 class="font-bold text-lg mb-3">Sort By</h3>
                    <select x-model="sortBy" @change="applySort" class="select select-bordered select-sm w-full">
                        <option value="upload_date_desc">üìÖ Newest First</option>
                        <option value="upload_date_asc">üìÖ Oldest First</option>
                        <option value="title_asc">üî§ Title (A-Z)</option>
                        <option value="title_desc">üî§ Title (Z-A)</option>
                        <option value="views_desc">üëÅÔ∏è Most Viewed</option>
                        <option value="views_asc">üëÅÔ∏è Least Viewed</option>
                        <option value="duration_desc">‚è±Ô∏è Longest First</option>
                        <option value="duration_asc">‚è±Ô∏è Shortest First</option>
                        <option value="likes_desc">‚ù§Ô∏è Most Liked</option>
                    </select>
                </div>
            </div>

            <!-- Tag Filters -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body p-4">
                    <h3 class="font-bold text-lg mb-3">Filter by Tags</h3>
                    <input
                        type="text"
                        x-model="tagSearchQuery"
                        placeholder="Search tags..."
                        class="input input-bordered input-sm w-full mb-3"
                    >
                    <div class="space-y-1 filter-sidebar">
                        <template x-for="tag in filteredTags" :key="tag.name">
                            <label class="flex items-center gap-2 p-2 rounded cursor-pointer tag-filter-item">
                                <input
                                    type="checkbox"
                                    :checked="filters.tags.includes(tag.name)"
                                    @change="toggleTagFilter(tag.name)"
                                    class="checkbox checkbox-primary checkbox-sm"
                                >
                                <span class="flex-1 text-sm" x-text="tag.name"></span>
                                <span class="badge badge-sm" x-text="tag.count"></span>
                            </label>
                        </template>
                        <div x-show="filteredTags.length === 0" class="text-center py-4 text-base-content/60 text-sm">
                            No tags found
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category Filter -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body p-4">
                    <h3 class="font-bold text-lg mb-3">Category</h3>
                    <select x-model="filters.category" class="select select-bordered select-sm w-full">
                        <option value="">All Categories</option>
                        <option value="education">üìö Education</option>
                        <option value="entertainment">üé≠ Entertainment</option>
                        <option value="music">üéµ Music</option>
                        <option value="gaming">üéÆ Gaming</option>
                        <option value="sports">‚öΩ Sports</option>
                        <option value="news">üì∞ News</option>
                        <option value="technology">üíª Technology</option>
                        <option value="tutorial">üéì Tutorial</option>
                        <option value="vlog">üìπ Vlog</option>
                        <option value="other">üì¶ Other</option>
                    </select>
                </div>
            </div>

            <!-- Status Filter -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body p-4">
                    <h3 class="font-bold text-lg mb-3">Status</h3>
                    <select x-model="filters.status" class="select select-bordered select-sm w-full">
                        <option value="">All Status</option>
                        <option value="active">‚úÖ Active</option>
                        <option value="draft">üìù Draft</option>
                        <option value="processing">‚öôÔ∏è Processing</option>
                        <option value="archived">üóÑÔ∏è Archived</option>
                    </select>
                </div>
            </div>

            <!-- Duration Filter -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body p-4">
                    <h3 class="font-bold text-lg mb-3">Duration</h3>
                    <div class="space-y-2">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" x-model="filters.duration" value="" class="radio radio-sm">
                            <span class="text-sm">Any Duration</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" x-model="filters.duration" value="short" class="radio radio-sm">
                            <span class="text-sm">Short (< 5 min)</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" x-model="filters.duration" value="medium" class="radio radio-sm">
                            <span class="text-sm">Medium (5-20 min)</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" x-model="filters.duration" value="long" class="radio radio-sm">
                            <span class="text-sm">Long (> 20 min)</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Visibility Filter -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body p-4">
                    <h3 class="font-bold text-lg mb-3">Visibility</h3>
                    <div class="space-y-2">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" x-model="filters.showPublic" class="checkbox checkbox-sm">
                            <span class="text-sm">Public Videos</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" x-model="filters.showPrivate" class="checkbox checkbox-sm">
                            <span class="text-sm">Private Videos</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Videos Display -->
        <div class="flex-1 space-y-6">
            <!-- Bulk Actions Bar (shown when items selected) -->
            <div x-show="selectedVideos.length > 0" class="card bg-primary text-primary-content shadow-xl">
                <div class="card-body p-4">
                    <div class="flex flex-wrap items-center gap-4">
                        <div class="flex items-center gap-2">
                            <input
                                type="checkbox"
                                :checked="selectedVideos.length === filteredVideos.length"
                                @change="toggleSelectAll"
                                class="checkbox checkbox-sm"
                            >
                            <span class="font-bold" x-text="selectedVideos.length + ' selected'"></span>
                        </div>
                        <div class="flex-1"></div>
                        <div class="flex flex-wrap gap-2">
                            <button @click="bulkAddTags" class="btn btn-sm gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                </svg>
                                Add Tags
                            </button>
                            <button @click="bulkRemoveTags" class="btn btn-sm gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                </svg>
                                Remove Tags
                            </button>
                            <button @click="bulkChangeVisibility" class="btn btn-sm gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                </svg>
                                Visibility
                            </button>
                            <button @click="bulkDelete" class="btn btn-error btn-sm gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                                Delete
                            </button>
                            <button @click="clearSelection" class="btn btn-ghost btn-sm">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Info -->
            <div class="flex justify-between items-center">
                <div>
                    <span class="text-sm text-base-content/70">
                        Showing <span class="font-bold" x-text="paginatedVideos.length"></span>
                        of <span class="font-bold" x-text="filteredVideos.length"></span> videos
                    </span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-sm text-base-content/70">Per page:</span>
                    <select x-model="perPage" class="select select-bordered select-sm">
                        <option value="12">12</option>
                        <option value="24">24</option>
                        <option value="48">48</option>
                        <option value="96">96</option>
                    </select>
                </div>
            </div>

            <!-- Grid View -->
            <div x-show="viewMode === 'grid'" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <template x-for="video in paginatedVideos" :key="video.id">
                    <div class="card bg-base-100 shadow-xl video-card-hover">
                        <!-- Selection Checkbox -->
                        <div class="absolute top-2 left-2 z-10">
                            <input
                                type="checkbox"
                                :checked="selectedVideos.includes(video.id)"
                                @change="toggleVideoSelection(video.id)"
                                class="checkbox checkbox-primary"
                            >
                        </div>

                        <!-- Thumbnail -->
                        <figure class="relative aspect-video bg-base-300 overflow-hidden">
                            <img
                                :src="video.thumbnail_url || '/storage/placeholder.jpg'"
                                :alt="video.title"
                                class="w-full h-full object-cover"
                                onerror="this.src='/storage/placeholder.jpg'"
                            >
                            <div class="absolute bottom-2 right-2 badge badge-sm badge-neutral" x-text="formatDuration(video.duration)"></div>
                        </figure>

                        <!-- Card Body -->
                        <div class="card-body p-4">
                            <h3 class="card-title text-base line-clamp-2" x-text="video.title"></h3>
                            <p class="text-sm text-base-content/60 line-clamp-2" x-text="video.short_description"></p>

                            <!-- Tags -->
                            <div class="flex flex-wrap gap-1 mt-2" x-show="video.tags && video.tags.length > 0">
                                <template x-for="tag in video.tags.slice(0, 3)" :key="tag">
                                    <span class="badge badge-primary badge-xs" x-text="tag"></span>
                                </template>
                                <span x-show="video.tags.length > 3" class="badge badge-ghost badge-xs">+<span x-text="video.tags.length - 3"></span></span>
                            </div>

                            <!-- Stats -->
                            <div class="flex items-center justify-between mt-3 text-xs text-base-content/60">
                                <div class="flex items-center gap-3">
                                    <span class="flex items-center gap-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                        </svg>
                                        <span x-text="video.view_count"></span>
                                    </span>
                                    <span class="flex items-center gap-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                                        </svg>
                                        <span x-text="video.like_count"></span>
                                    </span>
                                </div>
                                <span :class="video.is_public ? 'badge-success' : 'badge-error'" class="badge badge-xs" x-text="video.is_public ? 'PUBLIC' : 'PRIVATE'"></span>
                            </div>

                            <!-- Actions -->
                            <div class="card-actions justify-end mt-3">
                                <a :href="'/watch/' + video.slug" class="btn btn-primary btn-sm gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                                    </svg>
                                    Watch
                                </a>
                                <a :href="'/videos/' + video.id + '/edit'" class="btn btn-ghost btn-sm">
                                    Edit
                                </a>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!-- List View -->
            <div x-show="viewMode === 'list'" class="space-y-3">
                <template x-for="video in paginatedVideos" :key="video.id">
                    <div class="card bg-base-100 shadow-xl video-card-hover">
                        <div class="card-body p-4">
                            <div class="flex gap-4">
                                <!-- Checkbox -->
                                <input
                                    type="checkbox"
                                    :checked="selectedVideos.includes(video.id)"
                                    @change="toggleVideoSelection(video.id)"
                                    class="checkbox checkbox-primary self-start mt-1"
                                >

                                <!-- Thumbnail -->
                                <div class="w-40 h-24 bg-base-300 rounded overflow-hidden flex-shrink-0">
                                    <img
                                        :src="video.thumbnail_url || '/storage/placeholder.jpg'"
                                        :alt="video.title"
                                        class="w-full h-full object-cover"
                                        onerror="this.src='/storage/placeholder.jpg'"
                                    >
                                </div>

                                <!-- Content -->
                                <div class="flex-1 min-w-0">
                                    <h3 class="font-bold text-lg mb-1 truncate" x-text="video.title"></h3>
                                    <p class="text-sm text-base-content/60 mb-2 line-clamp-2" x-text="video.short_description"></p>

                                    <!-- Tags -->
                                    <div class="flex flex-wrap gap-1 mb-2" x-show="video.tags && video.tags.length > 0">
                                        <template x-for="tag in video.tags.slice(0, 5)" :key="tag">
                                            <span class="badge badge-primary badge-xs" x-text="tag"></span>
                                        </template>
                                    </div>

                                    <!-- Meta -->
                                    <div class="flex items-center gap-4 text-xs text-base-content/60">
                                        <span x-text="formatDuration(video.duration)"></span>
                                        <span x-text="video.view_count + ' views'"></span>
                                        <span x-text="video.like_count + ' likes'"></span>
                                        <span :class="video.is_public ? 'text-success' : 'text-error'" x-text="video.is_public ? 'Public' : 'Private'"></span>
                                    </div>
                                </div>

                                <!-- Actions -->
                                <div class="flex flex-col gap-2">
                                    <a :href="'/watch/' + video.slug" class="btn btn-primary btn-sm">Watch</a>
                                    <a :href="'/videos/' + video.id + '/edit'" class="btn btn-outline btn-sm">Edit</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Table View -->
            <div x-show="viewMode === 'table'" class="card bg-base-100 shadow-xl overflow-x-auto">
                <table class="table table-zebra">
                    <thead>
                        <tr>
                            <th>
                                <input
                                    type="checkbox"
                                    :checked="selectedVideos.length === filteredVideos.length"
                                    @change="toggleSelectAll"
                                    class="checkbox checkbox-sm"
                                >
                            </th>
                            <th>Video</th>
                            <th>Duration</th>
                            <th>Views</th>
                            <th>Likes</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="video in paginatedVideos" :key="video.id">
                            <tr>
                                <td>
                                    <input
                                        type="checkbox"
                                        :checked="selectedVideos.includes(video.id)"
                                        @change="toggleVideoSelection(video.id)"
                                        class="checkbox checkbox-sm"
                                    >
                                </td>
                                <td>
                                    <div class="flex items-center gap-3">
                                        <div class="avatar">
                                            <div class="w-16 h-10 rounded">
                                                <img :src="video.thumbnail_url || '/storage/placeholder.jpg'" :alt="video.title">
                                            </div>
                                        </div>
                                        <div>
                                            <div class="font-bold" x-text="video.title"></div>
                                            <div class="text-sm opacity-50" x-text="video.category"></div>
                                        </div>
                                    </div>
                                </td>
                                <td x-text="formatDuration(video.duration)"></td>
                                <td x-text="video.view_count"></td>
                                <td x-text="video.like_count"></td>
                                <td>
                                    <span :class="video.is_public ? 'badge-success' : 'badge-error'" class="badge badge-sm" x-text="video.is_public ? 'Public' : 'Private'"></span>
                                </td>
                                <td>
                                    <div class="flex gap-2">
                                        <a :href="'/watch/' + video.slug" class="btn btn-ghost btn-xs">Watch</a>
                                        <a :href="'/videos/' + video.id + '/edit'" class="btn btn-ghost btn-xs">Edit</a>
                                    </div>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>

            <!-- Empty State -->
            <div x-show="filteredVideos.length === 0" class="card bg-base-100 shadow-xl">
                <div class="card-body text-center py-16">
                    <div class="text-6xl mb-4">üì≠</div>
                    <h3 class="text-2xl font-bold mb-2">No videos found</h3>
                    <p class="text-base-content/60 mb-6">Try adjusting your filters or search query</p>
                    <button @click="clearAllFilters" class="btn btn-primary">Clear Filters</button>
                </div>
            </div>

            <!-- Pagination -->
            <div x-show="filteredVideos.length > perPage" class="flex justify-center">
                <div class="btn-group">
                    <button @click="previousPage" :disabled="currentPage === 1" class="btn btn-sm">¬´</button>
                    <template x-for="page in visiblePages" :key="page">
                        <button
                            @click="currentPage = page"
                            :class="{ 'btn-active': currentPage === page }"
                            class="btn btn-sm"
                            x-text="page"
                        ></button>
                    </template>
                    <button @click="nextPage" :disabled="currentPage === totalPages" class="btn btn-sm">¬ª</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Tag Modal -->
    <div x-show="showBulkTagModal" class="modal modal-open" x-cloak>
        <div class="modal-box">
            <h3 class="font-bold text-lg mb-4">Add Tags to Selected Videos</h3>
            <div class="form-control">
                <label class="label">
                    <span class="label-text">Tags (comma-separated)</span>
                </label>
                <input
                    type="text"
                    x-model="bulkTagInput"
                    placeholder="tag1, tag2, tag3"
                    class="input input-bordered"
                >
            </div>
            <div class="modal-action">
                <button @click="showBulkTagModal = false" class="btn btn-ghost">Cancel</button>
                <button @click="executeBulkAddTags" class="btn btn-primary">Add Tags</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
function videoLibrary() {
    return {
        // Mock data - replace with API calls
        videos: [
            { id: 1, slug: 'video-1', title: 'Introduction to Rust', short_description: 'Learn Rust basics', duration: 600, view_count: 1250, like_count: 45, is_public: 1, category: 'tutorial', status: 'active', tags: ['rust', 'programming', 'tutorial'], thumbnail_url: '' },
            { id: 2, slug: 'video-2', title: 'Advanced Web Development', short_description: 'Master modern web dev', duration: 1200, view_count: 890, like_count: 32, is_public: 1, category: 'tutorial', status: 'active', tags: ['web', 'javascript', 'tutorial'], thumbnail_url: '' },
            { id: 3, slug: 'video-3', title: 'Gaming Highlights 2024', short_description: 'Best gaming moments', duration: 180, view_count: 5600, like_count: 234, is_public: 1, category: 'gaming', status: 'active', tags: ['gaming', 'highlights', 'entertainment'], thumbnail_url: '' },
            { id: 4, slug: 'video-4', title: 'Music Production Tips', short_description: 'Create amazing music', duration: 900, view_count: 450, like_count: 28, is_public: 0, category: 'music', status: 'draft', tags: ['music', 'production', 'tutorial'], thumbnail_url: '' },
        ],
        availableTags: [
            { name: 'rust', count: 5 },
            { name: 'programming', count: 8 },
            { name: 'tutorial', count: 12 },
            { name: 'web', count: 6 },
            { name: 'javascript', count: 4 },
            { name: 'gaming', count: 3 },
            { name: 'music', count: 2 },
            { name: 'entertainment', count: 5 },
        ],

        // View state
        viewMode: 'grid',
        showFilters: false,

        // Search
        searchQuery: '',
        searchSuggestions: [],

        // Filters
        filters: {
            tags: [],
            category: '',
            status: '',
            duration: '',
            showPublic: true,
            showPrivate: true,
        },
        tagSearchQuery: '',

        // Sort
        sortBy: 'upload_date_desc',

        // Pagination
        currentPage: 1,
        perPage: 12,

        // Selection
        selectedVideos: [],

        // Bulk operations
        showBulkTagModal: false,
        bulkTagInput: '',

        get filteredVideos() {
            let result = this.videos;

            // Search filter
            if (this.searchQuery) {
                const query = this.searchQuery.toLowerCase();
                result = result.filter(v =>
                    v.title.toLowerCase().includes(query) ||
                    v.short_description.toLowerCase().includes(query) ||
                    v.tags.some(t => t.toLowerCase().includes(query))
                );
            }

            // Tag filter
            if (this.filters.tags.length > 0) {
                result = result.filter(v =>
                    this.filters.tags.some(tag => v.tags.includes(tag))
                );
            }

            // Category filter
            if (this.filters.category) {
                result = result.filter(v => v.category === this.filters.category);
            }

            // Status filter
            if (this.filters.status) {
                result = result.filter(v => v.status === this.filters.status);
            }

            // Duration filter
            if (this.filters.duration) {
                if (this.filters.duration === 'short') result = result.filter(v => v.duration < 300);
                if (this.filters.duration === 'medium') result = result.filter(v => v.duration >= 300 && v.duration <= 1200);
                if (this.filters.duration === 'long') result = result.filter(v => v.duration > 1200);
            }

            // Visibility filter
            if (!this.filters.showPublic) result = result.filter(v => !v.is_public);
            if (!this.filters.showPrivate) result = result.filter(v => v.is_public);

            // Apply sort
            return this.sortVideos(result);
        },

        get paginatedVideos() {
            const start = (this.currentPage - 1) * this.perPage;
            const end = start + parseInt(this.perPage);
            return this.filteredVideos.slice(start, end);
        },

        get totalPages() {
            return Math.ceil(this.filteredVideos.length / this.perPage);
        },

        get visiblePages() {
            const total = this.totalPages;
            const current = this.currentPage;
            const delta = 2;
            const range = [];

            for (let i = Math.max(2, current - delta); i <= Math.min(total - 1, current + delta); i++) {
                range.push(i);
            }

            if (current - delta > 2) range.unshift('...');
            if (current + delta < total - 1) range.push('...');

            range.unshift(1);
            if (total > 1) range.push(total);

            return range.filter((v, i, a) => a.indexOf(v) === i);
        },

        get filteredTags() {
            if (!this.tagSearchQuery) return this.availableTags;
            const query = this.tagSearchQuery.toLowerCase();
            return this.availableTags.filter(t => t.name.toLowerCase().includes(query));
        },

        get activeFiltersCount() {
            let count = 0;
            if (this.filters.tags.length > 0) count += this.filters.tags.length;
            if (this.filters.category) count++;
            if (this.filters.status) count++;
            if (this.filters.duration) count++;
            if (!this.filters.showPublic || !this.filters.showPrivate) count++;
            return count;
        },

        sortVideos(videos) {
            const sorted = [...videos];
            const [field, order] = this.sortBy.split('_');

            sorted.sort((a, b) => {
                let aVal, bVal;

                if (field === 'upload') {
                    aVal = a.id;
                    bVal = b.id;
                } else if (field === 'title') {
                    aVal = a.title.toLowerCase();
                    bVal = b.title.toLowerCase();
                } else if (field === 'views') {
                    aVal = a.view_count;
                    bVal = b.view_count;
                } else if (field === 'duration') {
                    aVal = a.duration;
                    bVal = b.duration;
                } else if (field === 'likes') {
                    aVal = a.like_count;
                    bVal = b.like_count;
                }

                if (order === 'asc') return aVal > bVal ? 1 : -1;
                return aVal < bVal ? 1 : -1;
            });

            return sorted;
        },

        handleSearch() {
            // Generate search suggestions
            if (this.searchQuery.length > 1) {
                this.searchSuggestions = this.videos
                    .map(v => v.title)
                    .filter(t => t.toLowerCase().includes(this.searchQuery.toLowerCase()))
                    .slice(0, 5);
            } else {
                this.searchSuggestions = [];
            }

            this.currentPage = 1;
        },

        applySearchSuggestion(suggestion) {
            this.searchQuery = suggestion;
            this.searchSuggestions = [];
        },

        applySort() {
            this.currentPage = 1;
        },

        toggleTagFilter(tag) {
            const index = this.filters.tags.indexOf(tag);
            if (index > -1) {
                this.filters.tags.splice(index, 1);
            } else {
                this.filters.tags.push(tag);
            }
            this.currentPage = 1;
        },

        removeTagFilter(tag) {
            const index = this.filters.tags.indexOf(tag);
            if (index > -1) {
                this.filters.tags.splice(index, 1);
            }
        },

        clearAllFilters() {
            this.filters = {
                tags: [],
                category: '',
                status: '',
                duration: '',
                showPublic: true,
                showPrivate: true,
            };
            this.searchQuery = '';
            this.tagSearchQuery = '';
            this.currentPage = 1;
        },

        toggleVideoSelection(id) {
            const index = this.selectedVideos.indexOf(id);
            if (index > -1) {
                this.selectedVideos.splice(index, 1);
            } else {
                this.selectedVideos.push(id);
            }
        },

        toggleSelectAll() {
            if (this.selectedVideos.length === this.filteredVideos.length) {
                this.selectedVideos = [];
            } else {
                this.selectedVideos = this.filteredVideos.map(v => v.id);
            }
        },

        clearSelection() {
            this.selectedVideos = [];
        },

        bulkAddTags() {
            this.showBulkTagModal = true;
        },

        executeBulkAddTags() {
            if (!this.bulkTagInput) return;

            const tags = this.bulkTagInput.split(',').map(t => t.trim()).filter(t => t);
            // API call here
            console.log('Adding tags', tags, 'to videos', this.selectedVideos);

            showToast(`Added tags to ${this.selectedVideos.length} videos`, 'success');
            this.showBulkTagModal = false;
            this.bulkTagInput = '';
            this.clearSelection();
        },

        bulkRemoveTags() {
            // Show modal to select tags to remove
            console.log('Remove tags from', this.selectedVideos);
            showToast('Feature coming soon', 'info');
        },

        bulkChangeVisibility() {
            // Toggle visibility for selected videos
            console.log('Change visibility for', this.selectedVideos);
            showToast(`Updated visibility for ${this.selectedVideos.length} videos`, 'success');
            this.clearSelection();
        },

        bulkDelete() {
            if (confirm(`Delete ${this.selectedVideos.length} videos? This cannot be undone.`)) {
                // API call here
                console.log('Deleting videos', this.selectedVideos);
                showToast(`Deleted ${this.selectedVideos.length} videos`, 'success');
                this.clearSelection();
            }
        },

        formatDuration(seconds) {
            if (!seconds) return '0:00';
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return h > 0
                ? `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`
                : `${m}:${s.toString().padStart(2, '0')}`;
        },

        previousPage() {
            if (this.currentPage > 1) this.currentPage--;
        },

        nextPage() {
            if (this.currentPage < this.totalPages) this.currentPage++;
        }
    }
}
</script>
{% endblock %}
